# Toratau Systems — Управление строительными объектами (MVP)

Система для отслеживания финансов строительных объектов: приход денег, расходы, начисления и выплаты бригадам, прогнозная прибыль.

## Возможности

- **Дашборд** — список объектов с ключевыми показателями и индикаторами риска
- **Карточка объекта** — сводка план-факт, платежи, расходы, работы, выплаты, бригады
- **Быстрое добавление работ** — вид работ → объём → авторасчёт → фото → сохранить (≤30 сек)
- **Управление выплатами** — создание и подтверждение выплат бригадам
- **Роли и права** — Администратор и Прораб с разделением доступа
- **Mobile-first** — оптимизирован для работы с телефона

## Структура проекта

```
Toratau-Systems/
├── frontend/           # React + TypeScript + Vite
│   ├── src/
│   │   ├── api/        # HTTP-клиент и модули API
│   │   ├── components/ # Переиспользуемые компоненты
│   │   ├── context/    # React Context (авторизация)
│   │   ├── hooks/      # Пользовательские хуки
│   │   ├── pages/      # Страницы приложения
│   │   ├── types/      # TypeScript-типы
│   │   └── utils/      # Утилиты и константы
│   ├── Dockerfile
│   └── nginx.conf
├── docker-compose.yml
└── README.md
```

## Быстрый старт

### Требования

- Node.js 18+
- npm 9+

### Локальная разработка (frontend)

```bash
cd frontend
cp .env.example .env
npm install
npm run dev
```

Приложение будет доступно на http://localhost:3000

### Docker (вместе с бэкендом)

```bash
docker-compose up --build
```

- Frontend: http://localhost:3000
- Backend API: http://localhost:8000

## Технологический стек (Frontend)

| Технология | Версия | Назначение |
|------------|--------|------------|
| React | 18 | UI-библиотека |
| TypeScript | 5.6 | Типизация |
| Vite | 6 | Сборщик |
| React Router | 6 | Маршрутизация |
| CSS (custom) | — | Стили (без фреймворков) |

## Страницы

| Маршрут | Описание | Доступ |
|---------|----------|--------|
| `/login` | Авторизация | Публичный |
| `/` | Дашборд объектов | Все роли |
| `/projects/new` | Создание объекта | Админ |
| `/projects/:id` | Карточка объекта (вкладки) | Все роли |
| `/projects/:id/edit` | Редактирование объекта | Админ |
| `/projects/:id/work-logs/new` | Добавить работу | Все роли |
| `/projects/:id/payouts/new` | Создать выплату | Все роли |
| `/projects/:id/cashin/new` | Добавить платёж | Все роли |
| `/projects/:id/expenses/new` | Добавить расход | Все роли |
| `/crews` | Управление бригадами | Админ |
| `/work-types` | Справочник видов работ | Админ |

## Расчётные метрики

```
Пришло денег           = Σ CashIn
Расходы (прочие)       = Σ Expense
Начислено бригадам     = Σ WorkLog(approved).volume × rate
Выплачено бригадам     = Σ Payout(approved)
Итого факт расход      = Расходы + Выплачено
Баланс объекта         = Пришло − Итого факт расход
Прогноз прибыли        = Контракт − (Расходы + Начислено)
Отклонение от плана    = (Расходы + Начислено) − Плановая себестоимость
```

## API-эндпоинты (ожидаемые от бэкенда)

| Метод | Путь | Описание |
|-------|------|----------|
| POST | `/auth/login` | Авторизация |
| GET | `/auth/me` | Текущий пользователь |
| CRUD | `/projects` | Объекты |
| CRUD | `/crews` | Бригады |
| CRUD | `/work-types` | Виды работ |
| CRUD | `/work-logs` | Выполненные работы |
| POST | `/work-logs/:id/approve` | Подтвердить работу |
| POST | `/work-logs/:id/reject` | Отклонить работу |
| POST | `/work-logs/:id/photos` | Загрузить фото |
| CRUD | `/cashin` | Входящие платежи |
| CRUD | `/expenses` | Расходы |
| CRUD | `/payouts` | Выплаты |
| POST | `/payouts/:id/approve` | Подтвердить выплату |
| POST | `/payouts/:id/cancel` | Отменить выплату |
| GET | `/reports/project/:id` | Отчёт по объекту |

## Лицензия

Проприетарный код. Все права защищены.
