# Системные шаблоны документов

Эта папка содержит системные шаблоны документов в формате `.docx`, которые используются по умолчанию для генерации документов.

## Как добавить или заменить шаблон

1. **Подготовьте ваш `.docx` файл** с плейсхолдерами в формате `docxtemplater`:
   - `{doc_number}` — номер документа
   - `{date}` — дата документа
   - `{buyer_name}`, `{buyer_inn}`, `{buyer_address}` — данные покупателя
   - `{seller_name}`, `{seller_inn}`, `{seller_address}` — данные продавца
   - `{total}` — итоговая сумма
   - `{#items}...{/items}` — цикл по позициям документа
   - И другие переменные (см. список ниже)

2. **Сохраните файл** с именем, соответствующим ID типа документа:
   - `contract_sale.docx` — Договор купли-продажи и поставки товара
   - `contract_spec.docx` — Спецификация к договору
   - `act_acceptance.docx` — Акт о сдаче-приемке выполненных работ
   - `act_ks2.docx` — Акт КС-2 о сдаче-приемке строительно-монтажных работ
   - `act_premises_transfer.docx` — Акт приема-передачи помещения
   - `power_of_attorney.docx` — Доверенность на получение ТМЦ
   - `commercial_offer.docx` — Коммерческое предложение
   - `payment_invoice.docx` — Счет на оплату
   - `contract_invoice.docx` — Счёт-договор и счёт-оферта
   - `vat_invoice.docx` — Счёт-фактура
   - `torg12.docx` — Товарная накладная форма № ТОРГ-12
   - `ks3.docx` — Справка КС-3

3. **Поместите файл** в эту папку (`frontend/public/templates/`)

4. **Перезапустите приложение** (если нужно) — файлы из `public/` доступны сразу

## Приоритет использования шаблонов

1. **Пользовательский шаблон** (из localStorage) — если пользователь загрузил свой шаблон через интерфейс "Шаблоны документов"
2. **Системный шаблон** (из этой папки) — если файл существует в `public/templates/{docType}.docx`
3. **Программная генерация** — если шаблонов нет, документ создаётся кодом

## Доступные переменные для шаблонов

### Основные данные документа
- `{doc_number}` — номер документа
- `{date}` — дата документа (формат: ДД.ММ.ГГГГ)
- `{basis}` — основание
- `{total}` — итоговая сумма (формат: 1 234,56)
- `{total_without_vat}` — итого без НДС / сумма без налога (формат: 1 234,56)
- `{total_vat}` — сумма НДС / итого НДС (формат: 1 234,56)
- `{total_with_vat}` — сумма с учётом НДС / итого к оплате (формат: 1 234,56)
- `{total_in_words}` — итого к оплате прописью (например: "двести тридцать пять тысяч триста пятьдесят семь рублей 20 копеек")
- `{notes}` — примечания
- `{taxation}` — налогообложение (текст)

### Данные продавца (организации)
- `{seller_name}` — название организации
- `{seller_inn}` — ИНН
- `{seller_kpp}` — КПП
- `{seller_address}` — адрес
- `{seller_bank}` — расчётный счёт
- `{seller_bik}` — БИК
- `{seller_bank_name}` — название банка
- `{seller_corr_account}` — корреспондентский счёт
- `{seller_director}` — руководитель (должность и ФИО)

### Данные покупателя (контрагента)
- `{buyer_name}` — название
- `{buyer_inn}` — ИНН
- `{buyer_kpp}` — КПП
- `{buyer_address}` — адрес
- `{buyer_bank}` — расчётный счёт
- `{buyer_bik}` — БИК
- `{buyer_bank_name}` — название банка
- `{buyer_corr_account}` — корреспондентский счёт
- `{buyer_director}` — руководитель

### Данные инвестора (для актов КС-2)
- `{investor_name}` — название
- `{investor_inn}` — ИНН
- `{investor_kpp}` — КПП
- `{investor_address}` — адрес

### Позиции документа (цикл)

**Важно:** Для использования цикла в таблице docx необходимо правильно оформить плейсхолдеры:

1. **В таблице:** Каждый плейсхолдер должен быть в отдельной ячейке таблицы
2. **Синтаксис цикла:** `{#items}` в начале строки данных, `{/items}` в конце строки данных
3. **Пример для таблицы:**

```
Заголовок таблицы:
| № | Товары (работы, услуги) | Кол-во | Ед. | Цена | Сумма |

Строка данных (цикл):
{#items}
| {n} | {name} | {qty} | {unit} | {price} | {sum} |
{/items}
```

**Вне таблицы (обычный текст):**
```
{#items}
{n}. {name} — {qty} {unit} × {price} = {sum}
{/items}
```

Доступные поля в цикле:
- `{n}` — номер позиции (1, 2, 3...)
- `{name}` — наименование
- `{unit}` — единица измерения
- `{qty}` — количество (строка)
- `{price}` — цена (формат: 1 234,56)
- `{sum}` — сумма (формат: 1 234,56)

### Дополнительные поля (зависят от типа документа)

Для актов КС-2:
- `{construction_name}` — наименование строительства
- `{construction_address}` — адрес строительства
- `{object_name}` — наименование объекта
- `{okdp}` — код ОКДП
- `{contract_number}` — номер договора
- `{contract_date}` — дата договора
- `{operation_type}` — вид работ
- `{estimated_cost}` — сметная стоимость
- `{period_from}` — период с
- `{period_to}` — период по

Для КС-3 (в цикле items):
- `{cost_from_start}` — стоимость с начала строительства
- `{cost_from_year_start}` — стоимость с начала года
- `{cost_for_period}` — стоимость за отчётный период

Для ТОРГ-12 (в цикле items):
- `{code}` — код товара
- `{packaging_type}` — вид упаковки
- `{packaging_qty}` — количество мест
- `{places_count}` — количество мест
- `{mass_kg}` — масса брутто (кг)

Для счёт-фактуры (в цикле items):
- `{code}` — код товара
- `{product_type_code}` — код вида товара
- `{okei_code}` — код ОКЕИ
- `{country_code}` — код страны
- `{country_name}` — наименование страны
- `{customs_declaration}` — номер таможенной декларации

## Пример шаблона

```
{doc_name} № {doc_number}
от {date}

Продавец: {seller_name}
ИНН {seller_inn} КПП {seller_kpp}
Адрес: {seller_address}

Покупатель: {buyer_name}
ИНН {buyer_inn} КПП {buyer_kpp}
Адрес: {buyer_address}

Основание: {basis}

Позиции:
{#items}
{n}. {name} — {qty} {unit} × {price} руб. = {sum} руб.
{/items}

Итого: {total} руб.

Примечания: {notes}
```

## Примечания

- Файлы должны быть в формате `.docx` (Microsoft Word 2007+)
- Используйте плейсхолдеры в фигурных скобках: `{переменная}`
- Для циклов используйте: `{#items}...{/items}`
- После изменения шаблона перезапуск приложения не требуется (файлы из `public/` доступны сразу)
- Если шаблон не найден, используется программная генерация документа
